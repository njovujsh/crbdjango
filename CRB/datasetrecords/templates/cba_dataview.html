{% extends "admindashboard.html" %}
    {% load my_custom_tags %}
    {% block title %}
    {{ block.super }} - {{datasetview|title|purge_underscore}}
    {% endblock title %}
    
    <!--block for updating records -->
    {% block updaterecords %}
    
    {% endblock updaterecords %}
    
    {% block viewrecords %}
    
    {% endblock viewrecords %}
    
    {% block innercontent %}
    
    {% endblock innercontent %}
    
    {% block searchforms %}
        <li class="menu-search">
            <a href="#">
                <i class="fa fa-search"></i> SEARCH
            </a>
            <!-- start: SEARCH POPOVER -->
            <div class="popover bottom search-box transition-all">
                <div class="arrow"></div>
            <div class="popover-content">
            <!-- start: SEARCH FORM -->
                <form class="" id="searchform" action="#">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search">
                            <span class="input-group-btn">
                                <button class="btn btn-main-color btn-squared" type="button">
                            <i class="fa fa-search"></i>
                        </button> </span>
                    </div>
                </form>
            <!-- end: SEARCH FORM -->
            </div>
            
            </div>
            <!-- end: SEARCH POPOVER -->
        </li>
    {% endblock searchforms %}
    
    {% block dataheader %}
        <h1>{{who|title|purge_underscore}}<small>Currently there are <b><code>{{ datacount }}</code></b> records in {{who}}</small></h1>
    {% endblock dataheader %}
    
    <!--Override the welcome superuser message-->
    {% block overridemsg %}
        <div class="space20">
            <div class="btn-group">
                <button class="btn btn-light-grey btn-sm dropdown-toggle" data-toggle="dropdown">
                    Select Action on {{who|title|purge_underscore}} <span class="caret"></span>
                </button>
                {% if user.is_superuser %}
                    <ul role="menu" class="dropdown-menu">
                        <li class="dropdown-header" role="presentation">
                            Action on validation 
                        </li>
                        <li>
                            <a href="/importdata/firstvalidate/{{who}}/" id="exportrecordss">
                                Validate {{who|title|purge_underscore}} and export records
                            </a>
                        </li>
                        <li>
                            <a href="/importdata/validatesave/{{who}}/" id="exportrecords2s">
                                Validate {{who|title|purge_underscore}} and save records
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li class="dropdown-header" role="presentation">
                            Report on Previous Validations
                        </li>
                        <li>
                            <a href="/validation/recentvalidation/successful/">
                                Get Validation Reports
                            </a>
                        </li>
                    </ul>
                {% else %}
                    <ul role="menu" class="dropdown-menu">
                        <li class="dropdown-header" role="presentation">
                            You are unauthorized to perform this actions 
                        </li>
                    </ul>
                {% endif %}
            </div>
            
            <div class="btn-group">
                <!--
                <div data-provides="fileupload" class="fileupload fileupload-new removebottom">
                      <input type="hidden" value="" name="">
                            <span class="btn btn-file btn-light-grey"><i class="fa fa-folder-open-o">
                            </i> <span class="fileupload-new">Import Records into {{who|title|purge_underscore}}</span>
                            <span class="fileupload-exists">Import</span>
                        <input type="file" name="">
                        </span>
                        <span class="fileupload-preview"></span>
                        <a data-dismiss="fileupload" class="close fileupload-exists float-none" href="#">
                            Ã—
                        </a>
                </div>
                -->
            </div>
            
            <div class="btn-group">
                <a class="btn btn-grey pull-right" href="/app/process/datasetrecord/{{who}}/"><i class="fa fa-plus"></i> New Record</a>
            </div>
            
            <div class="btn-group">
                <a class="btn btn-grey pull-right" href="/importdata/showsaved/andvalidated/">
                Validated Saved Records</a>
            </div>
        </div>
        <!--
        <label>
                <input type="text" aria-controls="sample_1" class="form-control input-sm add-width" placeholder="Search">
            </label>
        -->
    {% endblock overridemsg %}
    <!--ending the overriding method above-->
    
    {% block extendsuserbase %}
                <form role="form" class="form-horizontal" method="post" action="/submission/permanentpurging/deleting/{{who}}/">
                    <!--<input type="text" aria-controls="sample_1" class="form-control input-sm padding-r add-width" placeholder="Search">-->
                    {% csrf_token %} 
                    
                    {% if deletemode %}
                        <div class="form-actions">
                            <button type="submit" class="btn btn-green pull-rights" name ="submits">
                                Delete Selected Records <i class="fa fa-sarrow-circle-right"></i>
                            </button>
                        </div>
                    {% endif %}
                    <div class="tabbable">
                        <ul id="myTab" class="nav nav-tabs">
                            <li class="active">
                                <a href="#NewMonthlyRecords" data-toggle="tab">
                                    {{datacount}} New Monthly Records <span class="badges badge-danger"s> </span>
                                </a>
                            </li>

                            <li>
                                <a href="#OldRecords" data-toggle="tab" style="color:red; font-weight:bolder;">
                                    ( {{oldrecordscount}} ) Old Records <span class="badges badge-danger"s></span>
                                </a>
                            </li>
                            
                        </ul>
                    </div>
                    
                    <div class="tab-content">
                        <div class="tab-pane fade in active" id="NewMonthlyRecords">
                            <table class="table table-striped table-bordered table-hover table-full-width" id="creditstarttable">
                                    <thead>
                                        <tr>
                                            {% if deletemode %}
                                                <th class="centers">
                                                    <div class="checkbox-tables">
                                                        <input type="checkbox" class="flat-grey selectall">
                                                    </div>
                                                </th>
                                            {% endif %}
                                            <th class="reducesize there-size">Client Details</th>
                                            {% for instance in modelfields %}
                                                {% if instance|title == "Id" %}
                                                    <th class="reducesize there-size">Action</th>
                                                {% else %}
                                                    <th class="reducesize there-size">{{instance|title|purge_underscore}}</th>
                                                {% endif %}
                                            {% endfor %}
                                           
                                        </tr>
                                    </thead>
                                                        
                                    <tbody>
                                        
                                        
                                    {% for data in availabledata %}
                                        <tr>
                                                {% if data.Borrowers_Client_Number.client_details.surname %}
                                                    <td>{{data.Borrowers_Client_Number.client_details.surname}}</td>
                                                {% else %}
                                                    <td>{{data.Borrowers_Client_Number.client_details.business_name}}</td>
                                                {% endif %}
                                                
                                                {% if deletemode %}
                                                    <td class="center">
                                                        <div class="checkbox-tables">
                                                            <input type="checkbox" class="flat-grey foocheck" name="{{data.id}}">
                                                        </div>
                                                    </td>
                                                {% endif %}
                                                {%  if user.is_superuser %}
                                                    <td class="dataid" style="width:90px;"><a href="/data/updating/indentification/{{who}}/{{data.id}}/">Edit</a> |
                                                        <a href="/data/viewdetails/{{who}}/{{data.id}}/{{data.Borrowers_Client_Number.Client_Number}}/False/">View</a>
                                                    </td>

                                                {% else %}
                                                     <td class="dataid" style="width:90px;"><a href="/data/viewdetails/{{who}}/{{data.id}}/{{data.Borrowers_Client_Number.Client_Number}}/False/">View</a>
                                                    </td>
                                                {% endif %}
                                                
                                                <!--<td>{{data.Branch_Identification_Code}}</td>-->
                                                <td>{{data.Borrowers_Client_Number}}</td>
                                                <td>{{data.Borrower_Classification|check_classification}}</td>
                                                <td>{{data.Credit_Account_Reference}}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="tab-pane fade" id="OldRecords">
                                <p>Editing/Updating any old record will make it be renewed again.</p>
                                <a href="/purgebulk/deletingrecords/{{who}}/" class="btn btn-red pull-right"><i class="fa fa-trash-o"></i> Bulk Delete Permanently</a>
                                <table class="table table-striped table-bordered table-hover table-full-width" id="oldtablerecords">
                                    <thead>
                                        <tr>
                                            <th class="dataiddelete" style="width:5px !important;">Del</th>
                                            {% for instance in modelfields %}
                                                {% if instance|title == "Id" %}
                                                    {% if user.is_superuser %}
                                                        <th class="reducesize there-size">Action</th>
                                                    {% endif %}
                                                {% else %}
                                                    <th class="reducesize there-size" id="{{instance}}">{{instance|title|purge_underscore}}</th>
                                                {% endif %}
                                            {% endfor %}
                                        </tr>
                                    </thead>

                                    <tbody>
                                        {% for old in oldrecords %}
                                            <tr>
                                                {%  if user.is_superuser %}
                                                    <td class="dataiddelete" style="width:5px !important;">
                                                        <a href="/purge/runaptpurge/bydatatype/{{who}}/{{old.id}}/{{old.Borrowers_Client_Number.Client_Number}}/"><i class="fa fa-trash-o"></i></a>
                                                    </td>
                                                    <td class="dataid" style="width:90px;">
                                                        <a href="/data/updating/indentification/{{who}}/{{old.id}}/">Edit</a> |
                                                        <a href="/data/viewdetails/{{who}}/{{old.id}}/{{old.Borrowers_Client_Number.Client_Number}}/True/">View</a>
                                                    </td>

                                                {% else %}
                                                     <td class="dataid" style="width:90px;"><a href="/data/viewdetails/{{who}}/{{old.id}}/{{old.Borrowers_Client_Number.Client_Number}}/True/">View</a>
                                                    </td>
                                                {% endif %}
                                                <td>{{old.Borrowers_Client_Number}}</td>
                                                <td>{{old.Borrower_Classification|check_classification}}</td>
                                                <td>{{old.Credit_Account_Reference}}</td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                        </div>
                    </div>
                </form>
        
        <div class="pagination">
                    <span class="step-links">
                    {% if nextpage.has_previous %}
                        <a href="?page={{ nextpage.previous_page_number }}">Previous</a>
                    {% endif %}

                    <span class="current">
                        Page {{ nextpage.number }} of {{ nextpage.paginator.num_pages }}
                    </span>

                    {% if nextpage.has_next %}
                        <a href="?page={{ nextpage.next_page_number }}">Next</a>
                    {% endif %}
                    </span>
            </div>

    {% endblock extendsuserbase %}
